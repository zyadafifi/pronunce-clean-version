<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pronunciation Master</title>
    <!-- Google Fonts Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600&family=Amiri:wght@400;700&family=Cairo:wght@400;500;600&family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="simple-subtitles.css" />
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Mobile Video Container -->
    <div class="mobile-video-container" id="mobileVideoContainer">
    
      <!-- Mobile Progress Bar - New Design -->
      <div class="mobile-progress-bar" id="mobileProgressBar">
        <div class="progress-bullets" id="progressBullets">
          <!-- Bullets will be dynamically generated by JavaScript -->
        </div>
      </div>

      <!-- Back Button -->
      <div class="mobile-back-button" id="mobileBackButton">
        <button class="back-btn">
          <i class="fas fa-arrow-left"></i>
        </button>
      </div>

      <!-- Video Element -->
      <video
        class="mobile-lesson-video"
        id="mobileLessonVideo"
        playsinline
        preload="auto"
        muted
        webkit-playsinline
      >
        <source src="" type="video/mp4" />
        Your browser does not support the video tag.
      </video>

      <!-- iOS Audio Enable Overlay -->
      <div class="ios-audio-overlay" id="iosAudioOverlay" style="display: none">
        <div class="ios-audio-content">
          <i class="fas fa-volume-up"></i>
          <p>Tap to enable audio</p>
        </div>
      </div>

      <!-- Simple Subtitle Container at Top -->
      <div class="subtitle-container" id="mobileSubtitleContainer">
        <div class="subtitle-content">
          <div class="subtitle-english" id="mobileSubtitleEnglish"></div>
          <div class="subtitle-arabic" id="mobileSubtitleArabic"></div>
        </div>
      </div>

      <!-- Replay Button - Separate overlay on video -->
      <div class="mobile-replay-overlay" id="mobileReplayOverlay">
        <button class="mobile-replay-btn" id="mobileReplayBtn">
          <i class="fas fa-redo"></i> Replay
        </button>
      </div>

      <!-- Practice Overlay -->
      <div class="mobile-practice-overlay" id="mobilePracticeOverlay">
        <div class="practice-card">
          <div class="practice-header">
            <h3>Your turn!</h3>
            <p>
              Press the <i class="fas fa-microphone"></i> and record your voice.
            </p>
          </div>

          <!-- Sentence Display -->
          <div class="practice-sentence">
            <div class="sentence-text" id="mobilePracticeSentence">
              I want to learn English by speaking.
            </div>
            <div class="sentence-phonetic" id="mobilePracticePhonetic">
              ay waant tuh lÎµrrn ihng-glihsh bay spee-kihng.
            </div>
          </div>

          <!-- Control Buttons -->
          <div class="practice-controls" id="practiceControls">
            <button class="control-btn listen-btn" id="mobileListenBtn">
              <i class="fas fa-volume-up"></i>
              <span>Listen</span>
            </button>

            <button class="mic-btn" id="mobileMicBtn">
              <i class="fas fa-microphone"></i>
            </button>

            <button
              class="control-btn listen-slow-btn"
              id="mobileListenSlowBtn"
            >
              <i class="fas fa-headphones"></i>
              <span>Listen </span>
            </button>
          </div>
          <!-- Replace the existing mobile recording UI section with this -->

          <!-- Mobile Recording UI (initially hidden) -->
          <div class="mobile-recording-ui" id="mobileRecordingUI">
            <div class="mobile-waveform-container">
              <!-- Left pause/delete button -->
              <button
                class="mobile-pause-btn"
                id="mobileDeleteBtn"
                title="Delete recording"
              >
                <i class="fa-regular fa-trash-can"></i>
              </button>

              <!-- Center waveform area -->
              <div class="mobile-waveform-area">
                <!-- Waveform bars -->
                <div class="mobile-waveform-bars" id="mobileWaveformBars">
                  <!-- Generate 25 bars for optimal visual effect -->
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                  <div class="mobile-waveform-bar"></div>
                </div>

                <!-- Timer -->
                <div class="mobile-recording-timer" id="mobileRecordingTimer">
                  0:00
                </div>
              </div>

              <!-- Right send button -->
              <button
                class="mobile-send-btn"
                id="mobileStopBtn"
                title="Stop recording"
              >
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
          <!-- Alert container for mobile messages -->
          <div
            class="mobile-alert-container"
            id="mobileAlertContainer"
            style="display: none"
          >
            <div class="mobile-alert-content">
              <p id="mobileAlertMessage"></p>
              <button class="mobile-alert-close" id="mobileAlertClose">
                OK
              </button>
            </div>
          </div>
          <!-- Close Button -->
          <button class="practice-close-btn" id="mobilePracticeCloseBtn">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Lesson Completion Card -->
      <div class="mobile-completion-card" id="mobileCompletionCard">
        <div class="completion-content">
          <div class="completion-icon">
            <i class="fas fa-trophy"></i>
          </div>
          <h3>Lesson Completed!</h3>
          <p>
            Congratulations! You've successfully completed all sentences in this
            lesson.
          </p>

          <div class="completion-score">
            <span class="score-label">Final Score:</span>
            <span class="score-value" id="mobileFinalScore">0%</span>
          </div>

          <button class="completion-btn" id="mobileBackToLessonsBtn">
            <i class="fas fa-arrow-left"></i>
            Back to Lessons
          </button>
        </div>
      </div>
    </div>

    <!-- Desktop Layout (existing structure) -->
    <div class="desktop-container">
      <!-- Main Content Container -->
      <div class="main-container">
        <div class="content-wrapper">
          <!-- Learning Progress Section -->
          <div class="learning-progress-section">
            <div class="progress-header">
              <div class="progress-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <span class="progress-label">Learning Progress</span>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar-container">
              <div class="progress-bar-track">
                <div class="progress-bar-fill" id="progressBarFill">
                  <span class="progress-percentage">0%</span>
                </div>
              </div>
            </div>

            <div class="sentence-counter">
              <span class="current-sentence">1</span>
              <span class="counter-separator">of</span>
              <span class="total-sentences">5</span>
              <span class="counter-label">sentences</span>
            </div>
          </div>

          <!-- Watch & Learn Section -->
          <div class="watch-learn-section">
            <div class="section-header">
              <div class="section-icon">
                <i class="fas fa-play-circle"></i>
              </div>
              <h3>Watch & Learn</h3>
            </div>

            <!-- Video Container -->
            <div class="video-container">
              <video class="lesson-video" controls id="lessonVideo">
                <source src="" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
              <!-- Desktop Subtitle System -->
              <div class="subtitle-container" id="desktopSubtitleContainer">
                <div class="subtitle-content">
                  <div
                    class="subtitle-english"
                    id="desktopSubtitleEnglish"
                  ></div>
                  <div class="subtitle-arabic" id="desktopSubtitleArabic"></div>
                </div>
              </div>
            </div>

            <!-- Video Controls -->
            <div class="video-controls">
              <button class="btn btn-outline-primary" id="playVideoBtn">
                <i class="fas fa-play"></i> Watch Video
              </button>
              <button class="btn btn-outline-secondary" id="replayVideoBtn">
                <i class="fas fa-redo"></i> Replay
              </button>
            </div>
          </div>

          <!-- Practice Section -->
          <div class="practice-section">
            <!-- Arabic Text Container -->
            <div dir="rtl" class="arabic-instruction">
              <p>مرحبا! كيف حالك؟ اضغط على الميكروفون واقرأ الجملة التالية:</p>
            </div>

            <!-- English Sentence Container -->
            <div class="sentence-container" id="sentence">
              <p class="sentence-text">Welcome to the course!</p>
            </div>

            <!-- Arabic Translation -->
            <div class="translation-container" id="translationDiv">
              <p class="translation-text">أهلا بك في الدورة!</p>
            </div>

            <!-- Control Icons -->
            <div class="control-icons">
              <!-- Listen Button -->
              <button
                class="control-btn listen-btn"
                id="listenButton"
                title="Listen to example"
              >
                <i class="fas fa-volume-up"></i>
              </button>

              <!-- Microphone Button -->
              <button class="mic-button" id="micButton" title="Start recording">
                <i class="fas fa-microphone"></i>
              </button>

              <!-- Play Recording Button -->
              <button
                class="control-btn play-btn"
                id="bookmarkIcon"
                title="Play recorded audio"
              >
                <i class="fas fa-headphones"></i>
              </button>
            </div>

            <!-- Recording UI Container -->
            <div class="recording-ui-container">
              <div class="recording-controls">
                <button
                  class="recording-action-btn delete-btn"
                  id="deleteRecButton"
                >
                  <i class="fas fa-times"></i>
                </button>

                <div class="recording-visual">
                  <div class="recording-waveform">
                    <!-- Waveform bars will be generated here -->
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                    <div class="waveform-bar"></div>
                  </div>
                  <div class="recording-timer" id="recordingTimer">0:01</div>
                </div>

                <button
                  class="recording-action-btn send-btn"
                  id="stopRecButton"
                >
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>

            <!-- Recording Indicator -->
            <div id="recordingIndicator" class="recording-indicator">
              <i class="fas fa-circle recording-dot"></i>
              <span>Recording...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Results Dialog -->
      <div class="dialog-container" id="resultsDialog">
        <div class="dialog-backdrop"></div>
        <div class="dialog-content">
          <!-- Close Button -->
          <button class="close-btn" title="Close dialog">
            <i class="fas fa-times"></i>
          </button>

          <!-- Dialog Header -->
          <div class="dialog-header">
            <div class="dialog-icon">
              <i class="fas fa-microphone"></i>
            </div>
            <h4>Your Pronunciation Review</h4>

            <!-- Enhanced Pronunciation Score Circle -->
            <div class="score-circle-container">
              <div class="score-circle" id="scoreCircle">
                <div class="score-circle-inner">
                  <span class="score-percentage" id="scorePercentage">0%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Results Content -->
          <div class="results-content">
            <div id="recognizedText" class="recognized-text">
              <p>Please try again with another response.</p>
            </div>
          </div>

          <!-- Dialog Controls -->
          <div class="dialog-controls">
            <!-- Listen Button in Dialog -->
            <button
              class="control-btn listen-btn"
              id="listen2Button"
              title="Listen to example"
            >
              <i class="fas fa-volume-up"></i>
            </button>

            <!-- Action Buttons -->
            <div class="dialog-buttons">
              <button id="retryButton" class="btn btn-secondary">
                <i class="fas fa-redo"></i> Retry
              </button>
              <button id="nextButton" class="btn btn-primary">Continue</button>
            </div>

            <!-- Play Recording Button in Dialog -->
            <button
              class="control-btn play-btn"
              id="bookmark-icon2"
              title="Play recorded audio"
            >
              <i class="fas fa-headphones"></i>
            </button>
          </div>

          <!-- Hidden Pronunciation Score (for compatibility) -->
          <div
            id="pronunciationScore"
            class="pronunciation-score"
            style="display: none"
          >
            0%
          </div>
        </div>
      </div>

      <!-- Enhanced Congratulation Modal -->
      <div
        class="modal fade"
        id="congratulationModal"
        tabindex="-1"
        aria-labelledby="congratulationModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header border-0">
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body text-center">
              <!-- Celebration Image -->
              <img
                src="https://media.giphy.com/media/26u4lOMA8JKSnL9Uk/giphy.gif"
                alt="Celebration GIF"
                class="congrats-img"
              />
              <h5 class="modal-title" id="congratulationModalLabel">
                ðŸŽ‰ Congratulations! ðŸŽ‰
              </h5>
              <p>You've successfully completed this lesson!</p>

              <!-- Overall Score Display -->
              <div class="overall-score-container">
                <h4>Overall Score</h4>
                <p id="overallScore" class="overall-score">0%</p>
              </div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
              <button
                type="button"
                class="btn btn-primary continue-to-next-lesson"
              >
                <i class="fas fa-check"></i> Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Accessibility Announcements -->
    <div
      aria-live="polite"
      aria-atomic="true"
      class="sr-only"
      id="announcements"
    ></div>
    <!-- Mobile Results Dialog -->
    <div class="mobile-dialog-container" id="mobileResultsDialog">
      <div class="mobile-dialog-backdrop"></div>
      <div class="mobile-dialog-content">
        <!-- Close Button -->
        <button class="mobile-close-btn" id="mobileCloseBtn">
          <i class="fas fa-times"></i>
        </button>

        <!-- Dialog Header -->
        <div class="mobile-dialog-header">
          <div class="mobile-dialog-icon">
            <i class="fas fa-microphone"></i>
          </div>
          <h4>Your Pronunciation Review</h4>

          <!-- Pronunciation Score Circle -->
          <div class="mobile-score-circle-container">
            <div class="mobile-score-circle" id="mobileScoreCircle">
              <div class="mobile-score-circle-inner">
                <span class="mobile-score-percentage" id="mobileScorePercentage"
                  >0%</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Results Content -->
        <div class="mobile-results-content">
          <div id="mobileRecognizedText" class="mobile-recognized-text">
            <p>Please try again with another response.</p>
          </div>
          <div id="mobileMissingWords" class="mobile-missing-words"></div>
        </div>

        <!-- Dialog Controls -->
        <div class="mobile-dialog-controls">
          <!-- Listen Button -->
          <button
            class="mobile-control-btn mobile-listen-btn"
            id="mobileListenResultBtn"
            title="Listen to example"
          >
            <i class="fas fa-volume-up"></i>
          </button>

          <!-- Action Buttons -->
          <div class="mobile-dialog-buttons">
            <button
              id="mobileRetryButton"
              class="mobile-btn mobile-btn-secondary"
            >
              <i class="fas fa-redo"></i> Retry
            </button>
            <button id="mobileNextButton" class="mobile-btn mobile-btn-primary">
              Continue
            </button>
          </div>

          <!-- Play Recording Button -->
          <button
            class="mobile-control-btn mobile-play-btn"
            id="mobilePlayRecordingBtn"
            title="Play recorded audio"
          >
            <i class="fas fa-headphones"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Progress Manager Script - Load First -->
    <script src="progress-manager.js"></script>

    <!-- Enhanced Records Script -->
    <script src="records.js"></script>

    <!-- Additional Enhancement Scripts -->
    <script>
      // iOS Viewport Height Fix
      function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      }

      // Set viewport height on load and resize
      setViewportHeight();
      window.addEventListener("resize", setViewportHeight);
      window.addEventListener("orientationchange", function () {
        setTimeout(setViewportHeight, 100);
      });

      // Enhanced Touch Support
      document.addEventListener("DOMContentLoaded", function () {
        // Add touch feedback for all interactive elements
        const interactiveElements = document.querySelectorAll(
          "button, .control-btn, .mic-button, .waveform-btn"
        );

        interactiveElements.forEach((element) => {
          // Add touch start effect
          element.addEventListener(
            "touchstart",
            function (e) {
              this.style.transform = "scale(0.95)";
              this.style.transition = "transform 0.1s ease";
            },
            { passive: true }
          );

          // Add touch end effect
          element.addEventListener(
            "touchend",
            function (e) {
              setTimeout(() => {
                this.style.transform = "scale(1)";
              }, 100);
            },
            { passive: true }
          );

          // Add touch cancel effect
          element.addEventListener(
            "touchcancel",
            function (e) {
              this.style.transform = "scale(1)";
            },
            { passive: true }
          );
        });

        // Enhanced Accessibility
        const micButton = document.getElementById("micButton");
        const recordingIndicator =
          document.getElementById("recordingIndicator");
        const announcements = document.getElementById("announcements");

        // Announce recording state changes
        if (micButton && announcements) {
          const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              if (
                mutation.type === "attributes" &&
                mutation.attributeName === "class"
              ) {
                const isRecording = micButton.classList.contains("recording");
                if (isRecording) {
                  announcements.textContent = "Recording started. Speak now.";
                } else {
                  announcements.textContent =
                    "Recording stopped. Processing audio.";
                }
              }
            });
          });

          observer.observe(micButton, { attributes: true });
        }

        // Keyboard Navigation Enhancement
        document.addEventListener("keydown", function (e) {
          // Space bar to start/stop recording
          if (e.code === "Space" && e.target === document.body) {
            e.preventDefault();
            if (micButton && !micButton.disabled) {
              micButton.click();
            }
          }

          // Enter to continue/retry
          if (e.code === "Enter" || e.code === "NumpadEnter") {
            const activeDialog = document.querySelector(
              ".dialog-container.active"
            );
            if (activeDialog) {
              const nextBtn = document.getElementById("nextButton");
              const retryBtn = document.getElementById("retryButton");
              if (nextBtn && nextBtn.style.display !== "none") {
                nextBtn.click();
              } else if (retryBtn && retryBtn.style.display !== "none") {
                retryBtn.click();
              }
            }
          }

          // Escape to close dialog
          if (e.code === "Escape") {
            const activeDialog = document.querySelector(
              ".dialog-container.active"
            );
            if (activeDialog) {
              const closeBtn = document.querySelector(".close-btn");
              if (closeBtn) closeBtn.click();
            }
          }
        });

        // Enhanced Error Handling
        window.addEventListener("error", function (e) {
          console.error("Global error caught:", e.error);

          // Show user-friendly error message
          const errorDiv = document.createElement("div");
          errorDiv.className =
            "alert alert-danger alert-dismissible fade show position-fixed";
          errorDiv.style.top = "20px";
          errorDiv.style.right = "20px";
          errorDiv.style.zIndex = "9999";
          errorDiv.style.maxWidth = "300px";
          errorDiv.innerHTML = `
                    <strong>Oops!</strong> Something went wrong. Please refresh the page and try again.
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;

          document.body.appendChild(errorDiv);

          // Auto remove after 5 seconds
          setTimeout(() => {
            if (errorDiv.parentNode) {
              errorDiv.parentNode.removeChild(errorDiv);
            }
          }, 5000);
        });
      });

      // Handle URL parameters from React navigation
      function getUrlParameters() {
        const urlParams = new URLSearchParams(window.location.search);
        return {
          lesson: urlParams.get("lesson"),
          topic: urlParams.get("topic"),
          conversation: urlParams.get("conversation"),
        };
      }

      // Load conversation data based on URL parameters
      function loadConversationFromUrl() {
        const params = getUrlParameters();
        if (params.lesson && params.topic && params.conversation) {
          console.log("Loading conversation:", params);

          // Load the specific conversation data
          fetch("../data.json")
            .then((response) => response.json())
            .then((data) => {
              const lesson = data.lessons.find(
                (l) => l.lessonNumber == params.lesson
              );
              if (lesson) {
                const topic = lesson.topics.find((t) => t.id == params.topic);
                if (topic) {
                  const conversation = topic.conversations.find(
                    (c) => c.id == params.conversation
                  );
                  if (conversation) {
                    // Update mobile content with conversation data
                    updateMobileContentWithConversation(
                      conversation,
                      lesson,
                      topic
                    );
                  }
                }
              }
            })
            .catch((error) => {
              console.error("Error loading conversation data:", error);
            });
        }
      }

      // Update mobile content with conversation data
      function updateMobileContentWithConversation(
        conversation,
        lesson,
        topic
      ) {
        // Update progress bullets based on conversation sentences
        const progressBullets = document.getElementById("progressBullets");
        if (progressBullets) {
          progressBullets.innerHTML = "";
          conversation.sentences.forEach((_, index) => {
            const bullet = document.createElement("div");
            bullet.className = "progress-bullet";
            bullet.dataset.sentenceIndex = index;
            if (index === 0) {
              bullet.classList.add("active");
            } else {
              bullet.classList.add("inactive");
            }
            progressBullets.appendChild(bullet);
          });
        }

        // Update video source with first sentence
        const video = document.getElementById("mobileLessonVideo");
        if (video && conversation.sentences[0]) {
          video.src = conversation.sentences[0].videoSrc;
          video.load();
        }

        // Update subtitles
        const englishSubtitle = document.getElementById(
          "mobileSubtitleEnglish"
        );
        const arabicSubtitle = document.getElementById("mobileSubtitleArabic");
        if (englishSubtitle && conversation.sentences[0]) {
          englishSubtitle.textContent = conversation.sentences[0].english;
        }
        if (arabicSubtitle && conversation.sentences[0]) {
          arabicSubtitle.textContent = conversation.sentences[0].arabic;
        }

        // Update practice sentence
        const practiceSentence = document.getElementById(
          "mobilePracticeSentence"
        );
        const practicePhonetic = document.getElementById(
          "mobilePracticePhonetic"
        );
        if (practiceSentence && conversation.sentences[0]) {
          practiceSentence.textContent = conversation.sentences[0].english;
        }
        if (practicePhonetic && conversation.sentences[0]) {
          practicePhonetic.textContent =
            conversation.sentences[0].phonetic || "";
        }

        // Store conversation data globally for records.js
        window.currentConversation = conversation;
        window.currentLesson = lesson;
        window.currentTopic = topic;
      }

      // Load conversation when page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadConversationFromUrl();
      });
    </script>
  </body>
</html>
